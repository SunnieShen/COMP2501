y = "Number of People",
fill = "Talent Scheme"
) +
theme_minimal() +
theme(legend.position = "right",
axis.text.x = element_text(angle = 45, hjust = 1))
} else {
# 如果没有Scheme列，只显示总体趋势
scheme_data <- talent_inflow %>%
select(Year, Applications, Approvals) %>%
filter(!is.na(Year)) %>%
pivot_longer(cols = c(Applications, Approvals),
names_to = "Type",
values_to = "Count")
ggplot(scheme_data, aes(x = Year, y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", alpha = 0.8) +
labs(
title = "Talent Applications and Approvals",
subtitle = "Based on Real Scraped Data",
x = "Year",
y = "Number of People",
fill = "Type"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
}
} else {
cat("Warning: Required columns not found in talent_inflow data.\n")
if (exists("talent_inflow")) {
cat("Available columns:", paste(names(talent_inflow), collapse = ", "), "\n")
}
}
# 检查数据是否存在
if (exists("talent_summary") && nrow(talent_summary) > 0 &&
"Net_Talent_Flow" %in% names(talent_summary)) {
# 过滤掉NA值
plot_data <- talent_summary %>%
filter(!is.na(Net_Talent_Flow) & !is.na(Year))
if (nrow(plot_data) > 0) {
ggplot(plot_data, aes(x = Year, y = Net_Talent_Flow)) +
geom_col(aes(fill = Net_Talent_Flow > 0), alpha = 0.7) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
scale_fill_manual(
values = c("TRUE" = "#27ae60", "FALSE" = "#e74c3c"),
labels = c("TRUE" = "Net Inflow", "FALSE" = "Net Outflow"),
name = "Status"
) +
labs(
title = "Hong Kong Net Talent Flow",
subtitle = "Based on Real Scraped Data",
x = "Year",
y = "Net Talent Flow",
caption = "Positive values indicate net inflow, negative values indicate net outflow"
) +
theme_minimal() +
theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5))
} else {
cat("Warning: No valid data points for net talent flow.\n")
}
} else {
cat("Warning: Net talent flow data not available.\n")
}
# 检查是否有流失数据
if (exists("talent_outflow") && !is.null(talent_outflow) && nrow(talent_outflow) > 0) {
# 检查是否有Industry列
if ("Industry" %in% names(talent_outflow) && "Outflow" %in% names(talent_outflow)) {
industry_outflow_summary <- talent_outflow %>%
filter(!is.na(Industry) & !is.na(Outflow)) %>%
group_by(Industry) %>%
summarise(Total_Outflow = sum(Outflow, na.rm = TRUE), .groups = 'drop') %>%
arrange(desc(Total_Outflow)) %>%
filter(Total_Outflow > 0)
if (nrow(industry_outflow_summary) > 0) {
ggplot(industry_outflow_summary, aes(x = reorder(Industry, Total_Outflow), y = Total_Outflow)) +
geom_col(fill = "#e74c3c", alpha = 0.8) +
coord_flip() +
labs(
title = "Talent Outflow by Industry",
subtitle = "Based on Real Scraped Data",
x = "Industry",
y = "Number of Outflow",
caption = "Data from official sources"
) +
theme_minimal() +
theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5)) +
scale_y_continuous(labels = scales::comma_format())
} else {
cat("Note: No industry outflow data available for visualization.\n")
}
} else if ("Emigration" %in% names(talent_outflow)) {
# 如果有Emigration列但没有Industry列，显示总体趋势
cat("Note: Industry breakdown not available. Showing overall emigration data.\n")
# 可以在这里添加其他可视化
} else {
cat("Note: Outflow data structure does not match expected format.\n")
if (exists("talent_outflow")) {
cat("Available columns:", paste(names(talent_outflow), collapse = ", "), "\n")
}
}
} else {
cat("Note: No talent outflow data available.\n")
}
# 检查数据是否存在
if (exists("talent_inflow") && nrow(talent_inflow) > 0 &&
"Approval_Rate" %in% names(talent_inflow)) {
# 检查是否有Scheme列
if ("Scheme" %in% names(talent_inflow)) {
scheme_approval_rate <- talent_inflow %>%
filter(!is.na(Scheme) & !is.na(Approval_Rate)) %>%
group_by(Scheme) %>%
summarise(
Avg_Approval_Rate = mean(Approval_Rate, na.rm = TRUE),
Total_Applications = sum(Applications, na.rm = TRUE),
Total_Approvals = sum(Approvals, na.rm = TRUE),
.groups = 'drop'
) %>%
arrange(desc(Avg_Approval_Rate)) %>%
filter(!is.na(Avg_Approval_Rate))
if (nrow(scheme_approval_rate) > 0) {
ggplot(scheme_approval_rate, aes(x = reorder(Scheme, Avg_Approval_Rate), y = Avg_Approval_Rate)) +
geom_col(fill = "#3498db", alpha = 0.8) +
coord_flip() +
labs(
title = "Average Approval Rate by Talent Scheme",
subtitle = "Based on Real Scraped Data",
x = "Talent Scheme",
y = "Approval Rate (%)",
caption = "Data from official sources"
) +
theme_minimal() +
theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5)) +
geom_text(aes(label = paste0(round(Avg_Approval_Rate, 1), "%")),
hjust = -0.1, size = 3.5)
} else {
cat("Note: No valid approval rate data available.\n")
}
} else {
# 如果没有Scheme列，计算总体批准率
if ("Approval_Rate" %in% names(talent_inflow)) {
overall_rate <- mean(talent_inflow$Approval_Rate, na.rm = TRUE)
cat("Overall average approval rate:", round(overall_rate, 2), "%\n")
cat("Note: Scheme breakdown not available in the data.\n")
}
}
} else {
cat("Warning: Approval rate data not available.\n")
}
# 基于真实爬取的数据进行匹配度分析
# 如果数据中包含行业信息，进行分析；否则跳过
if (exists("talent_inflow") && nrow(talent_inflow) > 0) {
# 检查是否有Scheme或行业信息
if ("Scheme" %in% names(talent_inflow) || any(grepl("scheme|industry|行业|计划", names(talent_inflow), ignore.case = TRUE))) {
# 尝试识别Scheme或行业列
scheme_col <- names(talent_inflow)[grepl("scheme|计划|industry|行业", names(talent_inflow), ignore.case = TRUE)][1]
if (!is.na(scheme_col)) {
# 按Scheme/行业汇总
talent_by_scheme <- talent_inflow %>%
rename(Scheme_Industry = !!sym(scheme_col)) %>%
group_by(Scheme_Industry) %>%
summarise(
Total_Approvals = sum(Approvals, na.rm = TRUE),
Total_Applications = sum(Applications, na.rm = TRUE),
Avg_Approval_Rate = mean(Approval_Rate, na.rm = TRUE),
.groups = 'drop'
) %>%
arrange(desc(Total_Approvals)) %>%
filter(!is.na(Scheme_Industry) & Scheme_Industry != "")
if (nrow(talent_by_scheme) > 0) {
# 绘制各计划/行业的批准情况
ggplot(talent_by_scheme, aes(x = reorder(Scheme_Industry, Total_Approvals), y = Total_Approvals)) +
geom_col(fill = "#27ae60", alpha = 0.8) +
coord_flip() +
labs(
title = "Talent Approvals by Scheme/Industry",
subtitle = "Based on Scraped Real Data",
x = "Scheme/Industry",
y = "Total Approvals",
caption = "Data from Hong Kong Immigration Department"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.text.y = element_text(size = 8)
) +
scale_y_continuous(labels = scales::comma_format())
cat("=== Talent Distribution by Scheme/Industry ===\n")
print(talent_by_scheme)
}
}
} else {
cat("Note: No scheme/industry information found in the data for matching analysis.\n")
cat("The data may need additional processing to extract industry information.\n")
}
} else {
cat("Warning: No talent inflow data available for matching analysis.\n")
}
# 可视化产业人才缺口：需求 vs 供给
if (exists("gap_analysis") && nrow(gap_analysis) > 0) {
# 准备数据用于可视化
gap_plot_data <- gap_analysis %>%
select(Industry, Demand, Supply, Gap) %>%
pivot_longer(cols = c(Demand, Supply),
names_to = "Type",
values_to = "Count")
# 绘制需求与供给对比图
p1 <- ggplot(gap_plot_data, aes(x = reorder(Industry, Count), y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", alpha = 0.8) +
scale_fill_manual(
values = c("Demand" = "#e74c3c", "Supply" = "#27ae60"),
labels = c("Demand" = "Industry Demand", "Supply" = "Talent Supply")
) +
coord_flip() +
labs(
title = "Industry Talent Demand vs Supply",
subtitle = "Comparison of Job Demand and Talent Inflow",
x = "Industry",
y = "Number of People",
fill = "Type",
caption = "Based on Real Scraped Data"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.text.y = element_text(size = 8)
) +
scale_y_continuous(labels = scales::comma_format())
print(p1)
# 绘制缺口图
p2 <- ggplot(gap_analysis, aes(x = reorder(Industry, Gap), y = Gap, fill = Gap_Status)) +
geom_col(alpha = 0.8) +
scale_fill_manual(
values = c("Surplus" = "#27ae60", "Minor Gap" = "#f39c12",
"Moderate Gap" = "#e67e22", "Major Gap" = "#e74c3c"),
name = "Gap Status"
) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
labs(
title = "Talent Gap by Industry",
subtitle = "Positive values indicate shortage, negative values indicate surplus",
x = "Industry",
y = "Gap (Demand - Supply)",
caption = "Based on Real Scraped Data"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.text.y = element_text(size = 8)
) +
scale_y_continuous(labels = scales::comma_format())
print(p2)
# 绘制匹配率图
p3 <- ggplot(gap_analysis, aes(x = reorder(Industry, Match_Rate), y = Match_Rate)) +
geom_col(aes(fill = Match_Rate), alpha = 0.8) +
scale_fill_gradient2(low = "#e74c3c", mid = "#f39c12", high = "#27ae60",
midpoint = 50, name = "Match Rate (%)") +
coord_flip() +
geom_hline(yintercept = 100, linetype = "dashed", color = "gray50") +
labs(
title = "Talent Match Rate by Industry",
subtitle = "Percentage of demand met by talent supply",
x = "Industry",
y = "Match Rate (%)",
caption = "100% = demand fully met"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.text.y = element_text(size = 8)
)
print(p3)
} else {
cat("Note: Gap analysis data not available for visualization.\n")
cat("Please ensure both industry demand and talent supply data are available.\n")
}
# 创建多面板图
library(gridExtra)
p1 <- ggplot(talent_summary, aes(x = Year)) +
geom_line(aes(y = Total_Approvals), color = "#27ae60", size = 1) +
geom_line(aes(y = Total_Outflow), color = "#e74c3c", size = 1) +
labs(title = "Talent Inflow and Outflow", y = "Number of People") +
theme_minimal() +
theme(plot.title = element_text(size = 12, face = "bold"))
p2 <- ggplot(talent_summary, aes(x = Year, y = Net_Talent_Flow)) +
geom_col(fill = "#3498db", alpha = 0.7) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(title = "Net Talent Flow", y = "Number of People") +
theme_minimal() +
theme(plot.title = element_text(size = 12, face = "bold"))
p3 <- ggplot(scheme_approval_rate, aes(x = reorder(Scheme, Avg_Approval_Rate), y = Avg_Approval_Rate)) +
geom_col(fill = "#9b59b6", alpha = 0.7) +
coord_flip() +
labs(title = "Approval Rate by Scheme", x = "", y = "Approval Rate (%)") +
theme_minimal() +
theme(plot.title = element_text(size = 12, face = "bold"))
# 基于真实数据进行分析
if (exists("talent_inflow") && nrow(talent_inflow) > 0) {
cat("=== Talent Scheme Analysis (Based on Real Data) ===\n\n")
# 按Scheme分析
if ("Scheme" %in% names(talent_inflow)) {
scheme_analysis <- talent_inflow %>%
group_by(Scheme) %>%
summarise(
Total_Applications = sum(Applications, na.rm = TRUE),
Total_Approvals = sum(Approvals, na.rm = TRUE),
Avg_Approval_Rate = mean(Approval_Rate, na.rm = TRUE),
.groups = 'drop'
) %>%
arrange(desc(Total_Approvals))
print(scheme_analysis)
cat("\n=== Key Insights ===\n")
cat("Most successful scheme (by approvals):", scheme_analysis$Scheme[1], "\n")
cat("Highest approval rate:",
scheme_analysis$Scheme[which.max(scheme_analysis$Avg_Approval_Rate)],
"(", round(max(scheme_analysis$Avg_Approval_Rate, na.rm = TRUE), 2), "%)\n")
} else {
cat("Note: Scheme information not available in current data structure.\n")
cat("Data columns:", paste(names(talent_inflow), collapse = ", "), "\n")
}
} else {
cat("Warning: No data available for matching analysis.\n")
cat("Please ensure data scraping was successful.\n")
}
View(talent_inflow)
# 创建多面板图
library(gridExtra)
p1 <- ggplot(talent_summary, aes(x = Year)) +
geom_line(aes(y = Total_Approvals), color = "#27ae60", size = 1) +
geom_line(aes(y = Total_Outflow), color = "#e74c3c", size = 1) +
labs(title = "Talent Inflow and Outflow", y = "Number of People") +
theme_minimal() +
theme(plot.title = element_text(size = 12, face = "bold"))
p2 <- ggplot(talent_summary, aes(x = Year, y = Net_Talent_Flow)) +
geom_col(fill = "#3498db", alpha = 0.7) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(title = "Net Talent Flow", y = "Number of People") +
theme_minimal() +
theme(plot.title = element_text(size = 12, face = "bold"))
p3 <- ggplot(scheme_approval_rate, aes(x = reorder(Scheme, Avg_Approval_Rate), y = Avg_Approval_Rate)) +
geom_col(fill = "#9b59b6", alpha = 0.7) +
coord_flip() +
labs(title = "Approval Rate by Scheme", x = "", y = "Approval Rate (%)") +
theme_minimal() +
theme(plot.title = element_text(size = 12, face = "bold"))
# 可视化产业人才缺口：需求 vs 供给
if (exists("gap_analysis") && nrow(gap_analysis) > 0) {
# 准备数据用于可视化
gap_plot_data <- gap_analysis %>%
select(Industry, Demand, Supply, Gap) %>%
pivot_longer(cols = c(Demand, Supply),
names_to = "Type",
values_to = "Count")
# 绘制需求与供给对比图
p1 <- ggplot(gap_plot_data, aes(x = reorder(Industry, Count), y = Count, fill = Type)) +
geom_bar(stat = "identity", position = "dodge", alpha = 0.8) +
scale_fill_manual(
values = c("Demand" = "#e74c3c", "Supply" = "#27ae60"),
labels = c("Demand" = "Industry Demand", "Supply" = "Talent Supply")
) +
coord_flip() +
labs(
title = "Industry Talent Demand vs Supply",
subtitle = "Comparison of Job Demand and Talent Inflow",
x = "Industry",
y = "Number of People",
fill = "Type",
caption = "Based on Real Scraped Data"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.text.y = element_text(size = 8)
) +
scale_y_continuous(labels = scales::comma_format())
print(p1)
# 绘制缺口图
p2 <- ggplot(gap_analysis, aes(x = reorder(Industry, Gap), y = Gap, fill = Gap_Status)) +
geom_col(alpha = 0.8) +
scale_fill_manual(
values = c("Surplus" = "#27ae60", "Minor Gap" = "#f39c12",
"Moderate Gap" = "#e67e22", "Major Gap" = "#e74c3c"),
name = "Gap Status"
) +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
labs(
title = "Talent Gap by Industry",
subtitle = "Positive values indicate shortage, negative values indicate surplus",
x = "Industry",
y = "Gap (Demand - Supply)",
caption = "Based on Real Scraped Data"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.text.y = element_text(size = 8)
) +
scale_y_continuous(labels = scales::comma_format())
print(p2)
# 绘制匹配率图
p3 <- ggplot(gap_analysis, aes(x = reorder(Industry, Match_Rate), y = Match_Rate)) +
geom_col(aes(fill = Match_Rate), alpha = 0.8) +
scale_fill_gradient2(low = "#e74c3c", mid = "#f39c12", high = "#27ae60",
midpoint = 50, name = "Match Rate (%)") +
coord_flip() +
geom_hline(yintercept = 100, linetype = "dashed", color = "gray50") +
labs(
title = "Talent Match Rate by Industry",
subtitle = "Percentage of demand met by talent supply",
x = "Industry",
y = "Match Rate (%)",
caption = "100% = demand fully met"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.text.y = element_text(size = 8)
)
print(p3)
} else {
cat("Note: Gap analysis data not available for visualization.\n")
cat("Please ensure both industry demand and talent supply data are available.\n")
}
# 基于真实爬取的数据进行匹配度分析
# 如果数据中包含行业信息，进行分析；否则跳过
if (exists("talent_inflow") && nrow(talent_inflow) > 0) {
# 检查是否有Scheme或行业信息
if ("Scheme" %in% names(talent_inflow) || any(grepl("scheme|industry|行业|计划", names(talent_inflow), ignore.case = TRUE))) {
# 尝试识别Scheme或行业列
scheme_col <- names(talent_inflow)[grepl("scheme|计划|industry|行业", names(talent_inflow), ignore.case = TRUE)][1]
if (!is.na(scheme_col)) {
# 按Scheme/行业汇总
talent_by_scheme <- talent_inflow %>%
rename(Scheme_Industry = !!sym(scheme_col)) %>%
group_by(Scheme_Industry) %>%
summarise(
Total_Approvals = sum(Approvals, na.rm = TRUE),
Total_Applications = sum(Applications, na.rm = TRUE),
Avg_Approval_Rate = mean(Approval_Rate, na.rm = TRUE),
.groups = 'drop'
) %>%
arrange(desc(Total_Approvals)) %>%
filter(!is.na(Scheme_Industry) & Scheme_Industry != "")
if (nrow(talent_by_scheme) > 0) {
# 绘制各计划/行业的批准情况
ggplot(talent_by_scheme, aes(x = reorder(Scheme_Industry, Total_Approvals), y = Total_Approvals)) +
geom_col(fill = "#27ae60", alpha = 0.8) +
coord_flip() +
labs(
title = "Talent Approvals by Scheme/Industry",
subtitle = "Based on Scraped Real Data",
x = "Scheme/Industry",
y = "Total Approvals",
caption = "Data from Hong Kong Immigration Department"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.text.y = element_text(size = 8)
) +
scale_y_continuous(labels = scales::comma_format())
cat("=== Talent Distribution by Scheme/Industry ===\n")
print(talent_by_scheme)
}
}
} else {
cat("Note: No scheme/industry information found in the data for matching analysis.\n")
cat("The data may need additional processing to extract industry information.\n")
}
} else {
cat("Warning: No talent inflow data available for matching analysis.\n")
}
# 检查是否有流失数据
if (exists("talent_outflow") && !is.null(talent_outflow) && nrow(talent_outflow) > 0) {
# 检查是否有Industry列
if ("Industry" %in% names(talent_outflow) && "Outflow" %in% names(talent_outflow)) {
industry_outflow_summary <- talent_outflow %>%
filter(!is.na(Industry) & !is.na(Outflow)) %>%
group_by(Industry) %>%
summarise(Total_Outflow = sum(Outflow, na.rm = TRUE), .groups = 'drop') %>%
arrange(desc(Total_Outflow)) %>%
filter(Total_Outflow > 0)
if (nrow(industry_outflow_summary) > 0) {
ggplot(industry_outflow_summary, aes(x = reorder(Industry, Total_Outflow), y = Total_Outflow)) +
geom_col(fill = "#e74c3c", alpha = 0.8) +
coord_flip() +
labs(
title = "Talent Outflow by Industry",
subtitle = "Based on Real Scraped Data",
x = "Industry",
y = "Number of Outflow",
caption = "Data from official sources"
) +
theme_minimal() +
theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5)) +
scale_y_continuous(labels = scales::comma_format())
} else {
cat("Note: No industry outflow data available for visualization.\n")
}
} else if ("Emigration" %in% names(talent_outflow)) {
# 如果有Emigration列但没有Industry列，显示总体趋势
cat("Note: Industry breakdown not available. Showing overall emigration data.\n")
# 可以在这里添加其他可视化
} else {
cat("Note: Outflow data structure does not match expected format.\n")
if (exists("talent_outflow")) {
cat("Available columns:", paste(names(talent_outflow), collapse = ", "), "\n")
}
}
} else {
cat("Note: No talent outflow data available.\n")
}
